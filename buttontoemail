#include <Bridge.h>
#include <YunServer.h>
#include <YunClient.h>

const int buttonPin = 7;  
bool buttonPressed = false; 

// PushingBox API URL and Device ID
String pushingboxURL = "http://api.pushingbox.com/pushingbox";
String deviceID = "v0200C76CEAC801B";  

void setup() {
  Serial.begin(9600);
  
  Bridge.begin();

  pinMode(buttonPin, INPUT_PULLUP);  

  // Wait for the Yun to initialize
  delay(5000);
}

void loop() {
  static bool lastButtonState = HIGH;  
  bool currentButtonState = digitalRead(buttonPin); 


  if (lastButtonState == HIGH && currentButtonState == LOW) {
    buttonPressed = true;
    sendPushingBoxRequest();  
    delay(2000);  // Debounce delay to avoid multiple triggers
  } else if (currentButtonState == HIGH) {
    buttonPressed = false;  
  }

  lastButtonState = currentButtonState; 
}

void sendPushingBoxRequest() {
  // Using the Yun's Bridge to send an HTTP GET request to PushingBox
  Serial.println("Sending request to PushingBox...");

  Process p;
  p.begin("curl");  // Using curl command to send the HTTP request
  p.addParameter(pushingboxURL + "?devid=" + deviceID); 
  p.run();  // Run the command
  
  Serial.println("PushingBox request sent!");
}
